# 多线程

### 1. 什么是进程和线程

 进程：进程是程序的一次执行过程，是一个动态概念，是程序在执行过程中分配和管理资源的基本单位，每一个进程都有一个自己的地址空间，至少有 5 种基本状态，它们是：初始态，执行态，等待状态，就绪状态，终止状态。 

线程： 线程是CPU调度和分派的基本单位，它可与同属一个进程的其他的线程**共享**进程所拥有的全部资源。 每个线程都有自己的程序计数器、虚拟机栈、本地方法栈，也被称为轻量级线程。

### 2. 进程和线程的的关系，区别和优缺点？

一个进程有多个线程，多个线程共享进程的堆和方法区（1.8之后的元空间），但是**每个线程都有自己的程序计数器、虚拟机栈、本地方法栈**

总结：线程是进程划分成的更小的运行单位，最大不同是进程相互独立，线程不一定，线程开销小，但不利于资源的管理和保护，进程正相反。

**一句话了解堆和方法区：**

堆和方法区是所有线程共享的资源，堆是进程中最大的一块内存，存放新建的对象，方法区存放已加载的类信息、常量、静态变量等数据。



### 3. 并发与并行的区别

并发：同一时间段，多个任务在执行（单位时间内不一定同时执行）

并行：单位时间内，多个任务同时执行



### 4. 为什么用多线程

总体：

计算机底层：线程是轻量级进程，程序执行最小单位，线程的切换和调度成本小于进程，多核CPU意味着多个线程可以同时运行。

互联网趋势：要求百万级甚至千万级的并发量

底层探讨：

单核时代：为了提升CPU和IO设备的利用率

多核时代：为了提高CPU利用率



### 5. 多线程可能带来什么问题？

并发编程的目的是提高程序的执行效率和运行速度，但是并发编程不一定总能提高运行速度，而且可能遇到的问题：内存泄露、上下文切换、死锁还有受限于软硬件的资源闲置问题。



### 6. 线程的生命周期和状态？

线程的生命周期包含5个阶段，包括：新建、就绪、运行、阻塞、销毁。

- 新建：就是刚使用new方法，new出来的线程；
- 就绪：就是调用的线程的start()方法后，这时候线程处于等待CPU分配资源阶段，谁先抢的CPU资源，谁开始执行;
- 运行：当就绪的线程被调度并获得CPU资源时，便进入运行状态，run方法定义了线程的操作和功能;
- 阻塞：在运行状态的时候，可能因为某些原因导致运行状态的线程变成了阻塞状态，比如sleep()、wait()之后线程就处于了阻塞状态，这个时候需要其他机制将处于阻塞状态的线程唤醒，比如调用notify或者notifyAll()方法。唤醒的线程不会立刻执行run方法，它们要再次等待CPU分配资源进入运行状态;
- 销毁：如果线程正常执行完毕后或线程被提前强制性的终止或出现异常导致结束，那么线程就要被销毁，释放资源;
- **（超时等待？可以指定时间自行返回）**

### 7. 什么是上下文切换？

多线程编程中一般线程个数大于CPU核心数，一个CPU核心任意时刻只能被一个线程使用，为了让线程有效执行，CPU采取的策略是每个线程分配时间片轮转。一次轮转就是一次上下文切换

具体来说，就是执行完时间片时，保存自己的状态，下次切换回来时再次加载，**任务从保存到加载的过程就是一次上下文切换**

上下文切换通常是计算密集型，上下文切换需要大量CPU时间，**可能是操作系统中时间消耗最大的操作。**

Linux比其他系统的一个优点是上下文切换时间消耗很少

